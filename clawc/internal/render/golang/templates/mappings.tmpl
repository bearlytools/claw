
// Everything below this line is internal details.
{{- $file := .File }}

// Type hash constants for Any type support.
// These are SHAKE128 hashes (128 bits) of the full type path + name.
{{- range $file.Structs }}
// Deprecated: Not deprecated, but shouldn't be used directly or show up in documentation.
var XXXTypeHash{{ .Name }} = [16]byte{ {{- range $i, $b := .TypeHashBytes }}{{ if $i }}, {{ end }}0x{{ printf "%02x" $b }}{{ end -}} }
{{ end }}

{{- range $file.Structs }}
// Deprecated: Not deprecated, but shouldn't be used directly or show up in documentation.
var XXXMapping{{ .Name }} = &mapping.Map{
    Name: "{{ .Name }}",
    Pkg: "{{ $file.Package }}",
    Path: "{{ $file.FullPath }}",
    Fields: []*mapping.FieldDescr{
        {{- range $index, $field := .Fields }}
        {
            Name: "{{ $field.Name }}",
            Type: field.{{ $field.FieldTypeConst }},
            Package: "{{ $field.Package }}",
            FullPath: "{{ $field.FullPath }}",
            FieldNum: {{ $index }},
            IsEnum: {{ $field.IsEnum }},
            IsAny: {{ $field.IsAny }},
            {{- if $field.SelfReferential }}
            SelfReferential: true,
            {{- end }}
            {{- if or (eq $field.TypeAsString "Struct") (eq $field.TypeAsString "ListStructs") }}
            StructName: "{{ $field.IdentName }}",
            {{- end }}
            {{- if $field.IsEnum }}
            EnumGroup: "{{ $field.IdentName }}",
            {{- end }}
            {{- if or (eq $field.TypeAsString "Struct") (eq $field.TypeAsString "ListStructs") }}
            {{ if $field.IsExternal }}
            Mapping: {{ $field.Package }}.XXXMapping{{ $field.IdentInFile }},
            {{- else }}
            Mapping: XXXMapping{{ $field.IdentName }},
            {{- end }}
            {{- end }}
            {{- if $field.IsMap }}
            IsMap: true,
            KeyType: field.{{ $field.KeyTypeConst }},
            ValueType: field.{{ $field.ValueTypeConst }},
            {{- if $field.ValueIdentName }}
            {{- if $field.ValueIsExternal }}
            ValueMapping: {{ $field.ValuePackage }}.XXXMapping{{ $field.ValueIdentName }},
            {{- else }}
            ValueMapping: XXXMapping{{ $field.ValueIdentName }},
            {{- end }}
            {{- end }}
            {{- end }}
        },
        {{- end }}
    },
}
{{ end }}

// init initializes all mapping function pointer tables for O(1) dispatch.
func init() {
{{- range $file.Structs }}
    XXXMapping{{ .Name }}.Init()
{{- end }}
}
