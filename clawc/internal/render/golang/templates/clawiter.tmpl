// DO NOT EDIT
// This package is autogenerated and should not be modified except by the clawc compiler.

package {{ .File.Package }}

import (
    "context"
    "math"

    "github.com/bearlytools/claw/clawc/languages/go/clawiter"
    "github.com/bearlytools/claw/clawc/languages/go/field"
    {{ range .File.ExternalEnumImports }}
    "{{ $.Config.TransformImportPath . }}"
    {{- end }}
)

// Ensure imports are used.
var _ = math.Float32bits
var _ context.Context

{{- $file := .File }}

{{ range $structIndex, $struct := .File.Structs }}
// Walk calls yield for each token during serialization. If yield returns false, Walk stops and returns.
// This walks all fields including nested structs and lists.
func (x {{ $struct.Name }}) Walk(ctx context.Context, yield clawiter.YieldToken, opts ...clawiter.WalkOption) {
    if !yield(clawiter.Token{Kind: clawiter.TokenStructStart, Name: "{{ $struct.Name }}"}) {
        return
    }

        {{- range $fieldIndex, $field := $struct.Fields }}
        // Field {{ $field.Index }}: {{ $field.Name }}
        {{- if eq $field.TypeAsString "Bool" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTBool}
            tok.SetBool(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Int8" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTInt8}
            tok.SetInt8(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Int16" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTInt16}
            tok.SetInt16(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Int32" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTInt32}
            tok.SetInt32(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Int64" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTInt64}
            tok.SetInt64(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Uint8" }}
        {
            v := x.{{ $field.Name }}()
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTUint8}
            tok.SetUint8(uint8(v))
            {{- if $field.IsEnum }}
            tok.IsEnum = true
            tok.EnumGroup = "{{ $field.IdentInFile }}"
            tok.EnumName = {{ if $field.IsExternal }}{{ $field.Package }}.{{ end }}{{ $field.IdentInFile }}ByValue[uint8(v)]
            {{- end }}
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Uint16" }}
        {
            v := x.{{ $field.Name }}()
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTUint16}
            tok.SetUint16(uint16(v))
            {{- if $field.IsEnum }}
            tok.IsEnum = true
            tok.EnumGroup = "{{ $field.IdentInFile }}"
            tok.EnumName = {{ if $field.IsExternal }}{{ $field.Package }}.{{ end }}{{ $field.IdentInFile }}ByValue[uint16(v)]
            {{- end }}
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Uint32" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTUint32}
            tok.SetUint32(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Uint64" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTUint64}
            tok.SetUint64(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Float32" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTFloat32}
            tok.SetFloat32(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Float64" }}
        {
            tok := clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTFloat64}
            tok.SetFloat64(x.{{ $field.Name }}())
            if !yield(tok) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "String" }}
        {
            s := x.{{ $field.Name }}()
            if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTString, Bytes: []byte(s)}) {
                return
            }
        }
        {{- else if eq $field.TypeAsString "Bytes" }}
        if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTBytes, Bytes: x.{{ $field.Name }}()}) {
            return
        }
        {{- else if eq $field.TypeAsString "Struct" }}
        {
            nested := x.{{ $field.Name }}()
            isNil := nested.XXXGetStruct() == nil
            if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTStruct, StructName: "{{ $field.IdentName }}", IsNil: isNil}) {
                return
            }
            if !isNil {
                nested.Walk(ctx, yield, opts...)
            }
        }
        {{- else if eq $field.TypeAsString "ListBools" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListBools, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListBools}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListBools, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTBool}
                    tok.SetBool(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListUint8" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint8, IsNil: true{{- if $field.IsEnum }}, IsEnum: true, EnumGroup: "{{ $field.IdentInFile }}"{{- end }}}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint8{{- if $field.IsEnum }}, IsEnum: true, EnumGroup: "{{ $field.IdentInFile }}"{{- end }}}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListUint8, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTUint8}
                    tok.SetUint8(uint8(v))
                    {{- if $field.IsEnum }}
                    tok.IsEnum = true
                    tok.EnumGroup = "{{ $field.IdentInFile }}"
                    tok.EnumName = {{ if $field.IsExternal }}{{ $field.Package }}.{{ end }}{{ $field.IdentInFile }}ByValue[uint8(v)]
                    {{- end }}
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListUint16" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint16, IsNil: true{{- if $field.IsEnum }}, IsEnum: true, EnumGroup: "{{ $field.IdentInFile }}"{{- end }}}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint16{{- if $field.IsEnum }}, IsEnum: true, EnumGroup: "{{ $field.IdentInFile }}"{{- end }}}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListUint16, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTUint16}
                    tok.SetUint16(uint16(v))
                    {{- if $field.IsEnum }}
                    tok.IsEnum = true
                    tok.EnumGroup = "{{ $field.IdentInFile }}"
                    tok.EnumName = {{ if $field.IsExternal }}{{ $field.Package }}.{{ end }}{{ $field.IdentInFile }}ByValue[uint16(v)]
                    {{- end }}
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListUint32" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint32, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint32}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListUint32, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTUint32}
                    tok.SetUint32(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListUint64" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint64, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListUint64}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListUint64, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTUint64}
                    tok.SetUint64(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListInt8" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt8, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt8}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListInt8, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTInt8}
                    tok.SetInt8(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListInt16" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt16, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt16}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListInt16, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTInt16}
                    tok.SetInt16(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListInt32" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt32, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt32}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListInt32, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTInt32}
                    tok.SetInt32(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListInt64" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt64, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListInt64}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListInt64, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTInt64}
                    tok.SetInt64(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListFloat32" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListFloat32, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListFloat32}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListFloat32, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTFloat32}
                    tok.SetFloat32(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListFloat64" }}
        {
            list := x.{{ $field.Name }}()
            if list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListFloat64, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListFloat64}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListFloat64, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    tok := clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTFloat64}
                    tok.SetFloat64(v)
                    if !yield(tok) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListBytes" }}
        {
            list := x.{{ $field.Name }}()
            if list == nil || list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListBytes, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListBytes}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListBytes, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTBytes, Bytes: v}) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListStrings" }}
        {
            list := x.{{ $field.Name }}()
            if list == nil || list.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListStrings, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListStrings}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListStrings, Len: list.Len()}) {
                    return
                }
                for v := range list.All() {
                    if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "", Type: field.FTString, Bytes: []byte(v)}) {
                        return
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListStructs" }}
        {
            list := x.{{ $field.Name }}List(ctx)
            listLen := list.Len()
            if listLen == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListStructs, StructName: "{{ $field.IdentName }}", IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListStructs, StructName: "{{ $field.IdentName }}"}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListStructs, Len: listLen}) {
                    return
                }
                for i := 0; i < listLen; i++ {
                    item := x.{{ $field.Name }}Get(ctx, i)
                    item.Walk(ctx, yield, opts...)
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "Map" }}
        {
            m := x.{{ $field.Name }}Map()
            if m.Len() == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTMap, KeyType: field.{{ $field.KeyTypeConst }}, ValueType: field.{{ $field.ValueTypeConst }}, IsNil: true{{- if $field.ValueIdentName }}, StructName: "{{ $field.ValueIdentName }}"{{- end }}}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTMap, KeyType: field.{{ $field.KeyTypeConst }}, ValueType: field.{{ $field.ValueTypeConst }}{{- if $field.ValueIdentName }}, StructName: "{{ $field.ValueIdentName }}"{{- end }}}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenMapStart, Name: "{{ $field.Name }}", KeyType: field.{{ $field.KeyTypeConst }}, ValueType: field.{{ $field.ValueTypeConst }}, Len: m.Len()}) {
                    return
                }
                for k, v := range m.All() {
                    {{- if $field.ValueIdentName }}
                    // Map with struct values
                    tok := clawiter.Token{Kind: clawiter.TokenMapEntry, Name: "{{ $field.Name }}", KeyType: field.{{ $field.KeyTypeConst }}, ValueType: field.{{ $field.ValueTypeConst }}, StructName: "{{ $field.ValueIdentName }}"}
                    {{- else }}
                    tok := clawiter.Token{Kind: clawiter.TokenMapEntry, Name: "{{ $field.Name }}", KeyType: field.{{ $field.KeyTypeConst }}, ValueType: field.{{ $field.ValueTypeConst }}}
                    {{- end }}
                    // Set the key
                    {{- if eq $field.KeyTypeConst "FTString" }}
                    tok.KeyBytes = []byte(k)
                    {{- else if eq $field.KeyTypeConst "FTBool" }}
                    tok.SetKeyBool(k)
                    {{- else if eq $field.KeyTypeConst "FTInt8" }}
                    tok.SetKeyInt8(k)
                    {{- else if eq $field.KeyTypeConst "FTInt16" }}
                    tok.SetKeyInt16(k)
                    {{- else if eq $field.KeyTypeConst "FTInt32" }}
                    tok.SetKeyInt32(k)
                    {{- else if eq $field.KeyTypeConst "FTInt64" }}
                    tok.SetKeyInt64(k)
                    {{- else if eq $field.KeyTypeConst "FTUint8" }}
                    tok.SetKeyUint8(k)
                    {{- else if eq $field.KeyTypeConst "FTUint16" }}
                    tok.SetKeyUint16(k)
                    {{- else if eq $field.KeyTypeConst "FTUint32" }}
                    tok.SetKeyUint32(k)
                    {{- else if eq $field.KeyTypeConst "FTUint64" }}
                    tok.SetKeyUint64(k)
                    {{- else if eq $field.KeyTypeConst "FTFloat32" }}
                    tok.SetKeyFloat32(k)
                    {{- else if eq $field.KeyTypeConst "FTFloat64" }}
                    tok.SetKeyFloat64(k)
                    {{- end }}
                    // Set the value
                    {{- if $field.ValueIdentName }}
                    // Struct value - will be followed by struct walk
                    if !yield(tok) {
                        return
                    }
                    if v != nil {
                        {{- if $field.ValueIsExternal }}
                        wrapped := {{ $field.ValuePackage }}.XXXNew{{ $field.ValueIdentName }}From(v)
                        {{- else }}
                        wrapped := XXXNew{{ $field.ValueIdentName }}From(v)
                        {{- end }}
                        wrapped.Walk(ctx, yield, opts...)
                    }
                    {{- else if eq $field.ValueTypeConst "FTAny" }}
                    // Any value - yield token with type hash and raw data
                    if v != nil {
                        tok.TypeHash = v.TypeHash[:]
                        tok.Bytes = v.Data
                    }
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTListAny" }}
                    // List of Any values
                    if !yield(tok) {
                        return
                    }
                    if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "", Type: field.FTListAny, Len: len(v)}) {
                        return
                    }
                    for _, anyVal := range v {
                        anyTok := clawiter.Token{
                            Kind: clawiter.TokenField,
                            Name: "",
                            Type: field.FTAny,
                            TypeHash: anyVal.TypeHash[:],
                            Bytes: anyVal.Data,
                        }
                        if !yield(anyTok) {
                            return
                        }
                    }
                    if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: ""}) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTString" }}
                    tok.Bytes = []byte(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTBool" }}
                    tok.SetBool(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTInt8" }}
                    tok.SetInt8(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTInt16" }}
                    tok.SetInt16(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTInt32" }}
                    tok.SetInt32(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTInt64" }}
                    tok.SetInt64(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTUint8" }}
                    tok.SetUint8(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTUint16" }}
                    tok.SetUint16(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTUint32" }}
                    tok.SetUint32(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTUint64" }}
                    tok.SetUint64(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTFloat32" }}
                    tok.SetFloat32(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else if eq $field.ValueTypeConst "FTFloat64" }}
                    tok.SetFloat64(v)
                    if !yield(tok) {
                        return
                    }
                    {{- else }}
                    // Other value types
                    if !yield(tok) {
                        return
                    }
                    {{- end }}
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenMapEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "Any" }}
        {
            data, typeHash, ok := x.{{ $field.Name }}Raw()
            if !ok {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTAny, IsNil: true}) {
                    return
                }
            } else {
                tok := clawiter.Token{
                    Kind: clawiter.TokenField,
                    Name: "{{ $field.Name }}",
                    Type: field.FTAny,
                    Bytes: data,
                    TypeHash: typeHash[:],
                }
                if !yield(tok) {
                    return
                }
            }
        }
        {{- else if eq $field.TypeAsString "ListAny" }}
        {
            listLen := x.{{ $field.Name }}Len()
            if listLen == 0 {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListAny, IsNil: true}) {
                    return
                }
            } else {
                if !yield(clawiter.Token{Kind: clawiter.TokenField, Name: "{{ $field.Name }}", Type: field.FTListAny}) {
                    return
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListStart, Name: "{{ $field.Name }}", Type: field.FTListAny, Len: listLen}) {
                    return
                }
                for i := 0; i < listLen; i++ {
                    data, typeHash, ok := x.{{ $field.Name }}GetRaw(i)
                    if ok {
                        tok := clawiter.Token{
                            Kind: clawiter.TokenField,
                            Name: "",
                            Type: field.FTAny,
                            Bytes: data,
                            TypeHash: typeHash[:],
                        }
                        if !yield(tok) {
                            return
                        }
                    }
                }
                if !yield(clawiter.Token{Kind: clawiter.TokenListEnd, Name: "{{ $field.Name }}"}) {
                    return
                }
            }
        }
        {{- end }}
        {{- end }}

    if !yield(clawiter.Token{Kind: clawiter.TokenStructEnd, Name: "{{ $struct.Name }}"}) {
        return
    }
}
{{ end }}
